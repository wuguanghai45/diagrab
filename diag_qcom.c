#include "common.h"

static const uint8_t *g_mdm_req;
static int diag_verbose = 0;

/* List of processors */
#define DIAG_ALL_PROC		-1
#define DIAG_MODEM_PROC		0
#define DIAG_LPASS_PROC		1
#define DIAG_WCNSS_PROC		2
#define DIAG_SENSORS_PROC	3
#define DIAG_WDSP_PROC		4
#define DIAG_CDSP_PROC		5
#define DIAG_NPU_PROC		6
#define NUM_PERIPHERALS		7
#define DIAG_APPS_PROC		(NUM_PERIPHERALS)

#define GUID_LEN 16
#define MAX_GUID_ENTRIES 16
#define NUM_PROC 10

/* Invalid Command Response                   */
#define DIAG_BAD_CMD_F 19

/* Invalid parmaeter Response                 */
#define DIAG_BAD_PARM_F 20

/* Invalid packet length Response             */
#define DIAG_BAD_LEN_F 21

/* Subssytem dispatcher (extended diag cmd)   */
#define DIAG_SUBSYS_CMD_F 75

/* Subssytem dispatcher Version 2 (delayed response capable) */
#define DIAG_SUBSYS_CMD_VER_2_F 128

typedef enum
{
    DIAG_SUBSYS_DIAG_SERV = 18, /* DIAG Services */
} diagpkt_subsys_cmd_enum_type;

#define DIAG_GET_DIAG_ID 0x222

#define DIAGDIAG_QSR4_FILE_OP_MODEM 0x0816

#define DIAGDIAG_FILE_LIST_OPERATION 0x00
#define DIAGDIAG_FILE_OPEN_OPERATION 0x01
#define DIAGDIAG_FILE_READ_OPERATION 0x02
#define DIAGDIAG_FILE_CLOSE_OPERATION 0x03

typedef struct
{
    uint32 data1;
    uint16 data2;
    uint16 data3;
    uint8 data4[8];
} __attribute__((packed)) GUID;

typedef struct
{
    uint8 cmd_code;
    uint8 subsys_id;
    uint16 subsys_cmd_code;
} __attribute__((packed)) diag_pkt_header_t;

typedef struct
{
    uint8 cmd_code;
    uint8 subsys_id;
    uint16 subsys_cmd_code;
    uint16 version;
    uint16 opcode;
} __attribute__((packed)) diag_qsr_header_req;

typedef struct
{
    uint8 cmd_code;
    uint8 subsys_id;
    uint16 subsys_cmd_code;
    uint32 delayed_rsp_status;
    uint16 delayed_rsp_id;
    uint16 rsp_cnt;
    uint16 version;
    uint16 opcode;
} __attribute__((packed)) diag_qsr_header_rsp;

typedef struct
{
    uint8 guid[16];
    uint32 file_len;
} __attribute__((packed)) qshrink4_file_info;

typedef struct
{
    diag_qsr_header_rsp rsp_header;
    uint8 status;
    uint8 num_files;
    qshrink4_file_info info[0];
} __attribute__((packed)) diag_qsr_file_list_rsp;

typedef struct
{
    diag_qsr_header_req req;
    uint8 guid[16];
} __attribute__((packed)) diag_qsr_file_open_req;

typedef struct
{
    diag_qsr_header_rsp rsp_header;
    uint8 guid[16];
    uint16 read_file_fd;
    uint8 status;
} __attribute__((packed)) diag_qsr_file_open_rsp;

typedef struct
{
    diag_qsr_header_req req;
    uint16 read_file_fd;
} __attribute__((packed)) diag_qsr_file_close_req;

typedef struct
{
    diag_qsr_header_rsp rsp_header;
    uint16 read_file_fd;
    uint8 status;
} __attribute__((packed)) diag_qsr_file_close_rsp;

typedef struct
{
    diag_qsr_header_req req;
    uint16 read_file_fd;
    uint32 req_bytes;
    uint32 offset;
} __attribute__((packed)) diag_qsr_file_read_req;

typedef struct
{
    uint8 cmd_code;
    uint8 subsys_id;
    uint16 subsys_cmd_code;
    uint32 delayed_rsp_status;
    uint16 delayed_rsp_id;
    uint16 rsp_cnt;
    uint16 version;
    uint16 opcode;
    uint16 read_file_fd;
    uint32 offset;
    uint32 num_read;
    uint8 status;
    uint8 data[0];
} __attribute__((packed)) diag_qsr_file_read_rsp;

typedef struct
{
    uint32_t header_length;
    uint8_t version;
    uint8_t hdlc_data_type;
    uint32_t guid_list_entry_count;
    uint8_t guid[MAX_GUID_ENTRIES][GUID_LEN];
    uint32_t guid_file_len[MAX_GUID_ENTRIES];
} __attribute__((packed)) qshrink4_header;

typedef struct
{
    uint8 diag_id;
    char process_name[30];
    uint8 guid[GUID_LEN];
} __attribute__((packed)) diagid_guid_struct;

typedef struct
{
    uint8 cmd_code;
    uint8 subsys_id;
    uint16 subsys_cmd_code;
    uint8 version;
} __attribute__((packed)) diag_id_list_req;

typedef struct
{
    uint8 diag_id;
    uint8 len;
    char process_name[];
} __attribute__((packed)) diag_id_entry_struct;

typedef struct
{
    uint8 cmd_code;
    uint8 subsys_id;
    uint16 subsys_cmd_code;
    uint8 version;
    uint8 num_entries;
    diag_id_entry_struct entry;
} __attribute__((packed)) diag_id_list_rsp;

typedef struct
{
    uint8 diag_id;
    uint8 peripheral;
    char process_name[30];
} __attribute__((packed)) diag_id_list;

#define QSR4_DB_CMD_REQ_BUF_SIZE 50
#define QSR4_DB_READ_BUF_SIZE 5000
#define MAX_QSR4_DB_FILE_READ_PER_RSP 4000

typedef enum
{
    DB_PARSER_STATE_OFF,
    DB_PARSER_STATE_ON,
    DB_PARSER_STATE_LIST,
    DB_PARSER_STATE_OPEN,
    DB_PARSER_STATE_READ,
    DB_PARSER_STATE_CLOSE,
} qsr4_db_file_parser_state;

static pthread_mutex_t mdm_cmd_mutex = PTHREAD_MUTEX_INITIALIZER;
static pthread_cond_t mdm_cmd_cond = PTHREAD_COND_INITIALIZER;

static int parser_state;
static int diag_id_state;

static qshrink4_header qshrink4_data;
static diagid_guid_struct diagid_guid[MAX_GUID_ENTRIES];
static uint8 diag_id_count;
static diag_id_list diag_id_table[NUM_PROC];

static uint8_t cur_peripheral = DIAG_MODEM_PROC;
static int dm_fd = -1;
#define mdm_rsp_max (8 * 1024)
static uint8_t mdm_rsp_buf[mdm_rsp_max];
static size_t mdm_rsp_cur = 0;
static size_t mdm_rsp_size = 0;
static int read_file_fd = -1;
static uint32_t read_file_total_len = 0;
static uint32_t read_file_len = 0;
static int disk_file_fd = -1;

static void mdm_add_qshrink4_header(void)
{
    uint32_t header_length = 0;
    uint32_t count = cpu_to_le32(qshrink4_data.guid_list_entry_count);
    uint32_t *data_ptr = NULL;
    int fd = -1;

    header_length = 10 + count * GUID_LEN + sizeof(count) + count * sizeof(diagid_guid_struct);

    qshrink4_data.version = 2;
    qshrink4_data.hdlc_data_type = 1;

    data_ptr = (uint32_t *)(&qshrink4_data.guid[count][0]);
    *data_ptr++ = qshrink4_data.guid_list_entry_count;
    memcpy(data_ptr, diagid_guid, count * sizeof(diagid_guid_struct));

    qshrink4_data.header_length = cpu_to_le32(header_length);

    if (fd != -1)
    {
        write(fd, &qshrink4_data, header_length);
        close(fd);
    }
}

static unsigned char qsr4_db_cmd_req_buf[100];

#define CRC_16_L_SEED 0xFFFF
#define CRC_TAB_SIZE 256 /* 2^CRC_TAB_BITS      */
#define CRC_16_L_POLYNOMIAL 0x8408

const unsigned short crc_16_l_table[CRC_TAB_SIZE] = {
    0x0000, 0x1189, 0x2312, 0x329b, 0x4624, 0x57ad, 0x6536, 0x74bf,
    0x8c48, 0x9dc1, 0xaf5a, 0xbed3, 0xca6c, 0xdbe5, 0xe97e, 0xf8f7,
    0x1081, 0x0108, 0x3393, 0x221a, 0x56a5, 0x472c, 0x75b7, 0x643e,
    0x9cc9, 0x8d40, 0xbfdb, 0xae52, 0xdaed, 0xcb64, 0xf9ff, 0xe876,
    0x2102, 0x308b, 0x0210, 0x1399, 0x6726, 0x76af, 0x4434, 0x55bd,
    0xad4a, 0xbcc3, 0x8e58, 0x9fd1, 0xeb6e, 0xfae7, 0xc87c, 0xd9f5,
    0x3183, 0x200a, 0x1291, 0x0318, 0x77a7, 0x662e, 0x54b5, 0x453c,
    0xbdcb, 0xac42, 0x9ed9, 0x8f50, 0xfbef, 0xea66, 0xd8fd, 0xc974,
    0x4204, 0x538d, 0x6116, 0x709f, 0x0420, 0x15a9, 0x2732, 0x36bb,
    0xce4c, 0xdfc5, 0xed5e, 0xfcd7, 0x8868, 0x99e1, 0xab7a, 0xbaf3,
    0x5285, 0x430c, 0x7197, 0x601e, 0x14a1, 0x0528, 0x37b3, 0x263a,
    0xdecd, 0xcf44, 0xfddf, 0xec56, 0x98e9, 0x8960, 0xbbfb, 0xaa72,
    0x6306, 0x728f, 0x4014, 0x519d, 0x2522, 0x34ab, 0x0630, 0x17b9,
    0xef4e, 0xfec7, 0xcc5c, 0xddd5, 0xa96a, 0xb8e3, 0x8a78, 0x9bf1,
    0x7387, 0x620e, 0x5095, 0x411c, 0x35a3, 0x242a, 0x16b1, 0x0738,
    0xffcf, 0xee46, 0xdcdd, 0xcd54, 0xb9eb, 0xa862, 0x9af9, 0x8b70,
    0x8408, 0x9581, 0xa71a, 0xb693, 0xc22c, 0xd3a5, 0xe13e, 0xf0b7,
    0x0840, 0x19c9, 0x2b52, 0x3adb, 0x4e64, 0x5fed, 0x6d76, 0x7cff,
    0x9489, 0x8500, 0xb79b, 0xa612, 0xd2ad, 0xc324, 0xf1bf, 0xe036,
    0x18c1, 0x0948, 0x3bd3, 0x2a5a, 0x5ee5, 0x4f6c, 0x7df7, 0x6c7e,
    0xa50a, 0xb483, 0x8618, 0x9791, 0xe32e, 0xf2a7, 0xc03c, 0xd1b5,
    0x2942, 0x38cb, 0x0a50, 0x1bd9, 0x6f66, 0x7eef, 0x4c74, 0x5dfd,
    0xb58b, 0xa402, 0x9699, 0x8710, 0xf3af, 0xe226, 0xd0bd, 0xc134,
    0x39c3, 0x284a, 0x1ad1, 0x0b58, 0x7fe7, 0x6e6e, 0x5cf5, 0x4d7c,
    0xc60c, 0xd785, 0xe51e, 0xf497, 0x8028, 0x91a1, 0xa33a, 0xb2b3,
    0x4a44, 0x5bcd, 0x6956, 0x78df, 0x0c60, 0x1de9, 0x2f72, 0x3efb,
    0xd68d, 0xc704, 0xf59f, 0xe416, 0x90a9, 0x8120, 0xb3bb, 0xa232,
    0x5ac5, 0x4b4c, 0x79d7, 0x685e, 0x1ce1, 0x0d68, 0x3ff3, 0x2e7a,
    0xe70e, 0xf687, 0xc41c, 0xd595, 0xa12a, 0xb0a3, 0x8238, 0x93b1,
    0x6b46, 0x7acf, 0x4854, 0x59dd, 0x2d62, 0x3ceb, 0x0e70, 0x1ff9,
    0xf78f, 0xe606, 0xd49d, 0xc514, 0xb1ab, 0xa022, 0x92b9, 0x8330,
    0x7bc7, 0x6a4e, 0x58d5, 0x495c, 0x3de3, 0x2c6a, 0x1ef1, 0x0f78};

unsigned short crc_16_l_calc(const uint8_t *buf_ptr, int len)
{
    int data, crc_16;
    for (crc_16 = CRC_16_L_SEED; len >= 8; len -= 8, buf_ptr++)
    {
        crc_16 = crc_16_l_table[(crc_16 ^ *buf_ptr) & 0x00ff] ^ (crc_16 >> 8);
    }
    if (len != 0)
    {

        data = ((int)(*buf_ptr)) << (16 - 8);

        while (len-- != 0)
        {
            if (((crc_16 ^ data) & 0x01) != 0)
            {

                crc_16 >>= 1;
                crc_16 ^= CRC_16_L_POLYNOMIAL;
            }
            else
            {

                crc_16 >>= 1;
            }

            data >>= 1;
        }
    }
    return (~crc_16);
}

static int wait_for_response(int *p_wait_zero)
{
    struct timespec time;
    struct timeval now;
    int rt = 0;
    int i = 0;

    if (*p_wait_zero)
    {
        if (diag_verbose)
            DBG("%s value=%d", __func__, *p_wait_zero);
    }

    for (i = 0; i < 10; i++)
    {
        if (*p_wait_zero == 0)
        {
            rt = 0;
            break;
        }

        gettimeofday(&now, NULL);
        time.tv_sec = now.tv_sec + 1;
        time.tv_nsec = now.tv_usec;

        pthread_mutex_lock(&mdm_cmd_mutex);
        rt = pthread_cond_timedwait(&mdm_cmd_cond, &mdm_cmd_mutex, &time);
        pthread_mutex_unlock(&mdm_cmd_mutex);

        if (rt != ETIMEDOUT)
            break;
    }

    *p_wait_zero = 0;
    return rt;
}

static void wakeup_response(int *p_wait_zero)
{
    if (diag_verbose)
        DBG("%s value=%d", __func__, *p_wait_zero);
    *p_wait_zero = 0;
    pthread_mutex_lock(&mdm_cmd_mutex);
    pthread_cond_signal(&mdm_cmd_cond);
    pthread_mutex_unlock(&mdm_cmd_mutex);
}

static uint16_t diag_qsr4_append_crc16(uint8_t *buf_ptr, int len)
{
    uint16_t crc = crc_16_l_calc(buf_ptr, len * 8);

    buf_ptr[len++] = crc & 0xFF;
    buf_ptr[len++] = (crc >> 8) & 0xFF;
    buf_ptr[len++] = 0x7E;

    return len;
}

static const char *guid_file_name(const uint8_t *guid)
{
    static char read_buf[128];
    GUID *guid_val = (GUID *)guid;

    snprintf(read_buf, 100, "%08x-%04x-%04x-%02x%02x-%02x%02x%02x%02x%02x%02x.qdb", cpu_to_le32(guid_val->data1),
             cpu_to_le16(guid_val->data2), cpu_to_le16(guid_val->data3), guid_val->data4[0], guid_val->data4[1],
             guid_val->data4[2], guid_val->data4[3], guid_val->data4[4], guid_val->data4[5],
             guid_val->data4[6], guid_val->data4[7]);

    return read_buf;
}

static int diag_send_data(unsigned char buf[], size_t bytes)
{
    size_t i, size = 0;
    unsigned char *dst = &qsr4_db_cmd_req_buf[bytes];

    bytes -= 1; //skip 0x7E
    for (i = 0; i < bytes; i++)
    {
        uint8_t ch = buf[i];

        if (ch == 0x7E || ch == 0x7D)
        {
            dst[size++] = 0x7D;
            dst[size++] = (0x20 ^ ch);
        }
        else
        {
            dst[size++] = ch;
        }
    }
    dst[size++] = 0x7E;

    if (dm_fd != -1)
    {
        if (ss_got_signal)
            return safe_poll_write(dm_fd, dst, size, 1000);
        else
            return qcom_send_cmd(dm_fd, dst, size);
    }

    return 0;
}

static int diag_qsr4_get_cmd_code_for_peripheral(int peripheral)
{
    switch (peripheral)
    {
    case DIAG_MODEM_PROC:
        return DIAGDIAG_QSR4_FILE_OP_MODEM;
    default:
        return -1;
    }
}

static int diag_query_pd_name(const char *process_name, const char *search_str)
{
    if (!process_name)
        return -EINVAL;

    if (strstr(process_name, search_str))
        return 1;

    return 0;
}

static int diag_query_pd(const char *process_name)
{
    if (!process_name)
        return -EINVAL;

    if (diag_query_pd_name(process_name, "APPS"))
        return DIAG_APPS_PROC;
    if (diag_query_pd_name(process_name, "Apps"))
        return DIAG_APPS_PROC;
    if (diag_query_pd_name(process_name, "modem/root_pd"))
        return DIAG_MODEM_PROC;

    return -EINVAL;
}

static diag_id_list *get_diag_id(int peripheral)
{
    diag_id_list *item = NULL;
    uint8_t i;

    for (i = 0; i < diag_id_count; i++)
    {
        item = &diag_id_table[i];

        if ((peripheral == item->peripheral) && diag_query_pd_name(item->process_name, "root"))
            return item;
    }

    return NULL;
}

static void insert_diag_qsr4_db_guid_to_list(qshrink4_file_info *db_file_info, int peripheral)
{
    diag_id_list *item = NULL;
    qshrink4_header *qshrink4_data_ptr;
    uint32_t guid_list_entry_count;

    qshrink4_data_ptr = &qshrink4_data;
    guid_list_entry_count = cpu_to_le32(qshrink4_data_ptr->guid_list_entry_count);

    if (guid_list_entry_count >= MAX_GUID_ENTRIES)
        return;

    memcpy(&qshrink4_data_ptr->guid[guid_list_entry_count], db_file_info->guid, GUID_LEN);
    qshrink4_data_ptr->guid_file_len[guid_list_entry_count] = cpu_to_le32(db_file_info->file_len);

    item = get_diag_id(peripheral);
    if (item)
    {
        diagid_guid[guid_list_entry_count].diag_id = item->diag_id;
        strncpy(diagid_guid[guid_list_entry_count].process_name, item->process_name, 30);
    }
    memcpy(&diagid_guid[guid_list_entry_count].guid, db_file_info->guid, GUID_LEN);

    guid_list_entry_count++;
    qshrink4_data_ptr->guid_list_entry_count = cpu_to_le32(guid_list_entry_count);
}

static int diag_send_qsr4_db_file_list_cmd_req(int peripheral)
{
    unsigned char *ptr = qsr4_db_cmd_req_buf;
    diag_qsr_header_req *req = NULL;

    if (diag_qsr4_get_cmd_code_for_peripheral(peripheral) == -1)
        return 0;

    DBG("%s peripheral=%d", __func__, peripheral);

    cur_peripheral = peripheral;

    req = (diag_qsr_header_req *)ptr;

    req->cmd_code = DIAG_SUBSYS_CMD_VER_2_F;
    req->subsys_id = DIAG_SUBSYS_DIAG_SERV;
    req->subsys_cmd_code = cpu_to_le16(diag_qsr4_get_cmd_code_for_peripheral(peripheral));
    req->version = cpu_to_le16(1);
    req->opcode = cpu_to_le16(DIAGDIAG_FILE_LIST_OPERATION);

    parser_state = DB_PARSER_STATE_OPEN;
    diag_send_data(ptr, diag_qsr4_append_crc16(ptr, sizeof(diag_qsr_header_req)));
    wait_for_response(&parser_state);

    return 0;
}

static void process_qsr4_db_file_list_response(const uint8_t *buf, size_t size)
{
    (void)size;
    diag_qsr_file_list_rsp *list_rsp = (diag_qsr_file_list_rsp *)buf;
    uint8_t i;

    if (list_rsp->status == 0)
    {
        for (i = 0; i < list_rsp->num_files; i++)
        {
            if (cpu_to_le32(list_rsp->info[i].file_len))
            {
                DBG("guid: len = %u, name = %s", cpu_to_le32(list_rsp->info[i].file_len), guid_file_name(list_rsp->info[i].guid));
                insert_diag_qsr4_db_guid_to_list(&list_rsp->info[i], cur_peripheral);
            }
        }
    }
    else
    {
        DBG("%s status %d", __func__, list_rsp->status);
    }

    wakeup_response(&parser_state);
}

static int diag_send_qsr4_file_open_cmd_req(int idx)
{
    unsigned char *ptr = qsr4_db_cmd_req_buf;
    diag_qsr_file_open_req *req_ptr;

    DBG("%s idx=%d", __func__, idx);

    req_ptr = (diag_qsr_file_open_req *)ptr;
    req_ptr->req.cmd_code = DIAG_SUBSYS_CMD_VER_2_F;
    req_ptr->req.subsys_id = DIAG_SUBSYS_DIAG_SERV;
    req_ptr->req.subsys_cmd_code = cpu_to_le16(diag_qsr4_get_cmd_code_for_peripheral(cur_peripheral));
    req_ptr->req.version = cpu_to_le16(1);
    req_ptr->req.opcode = cpu_to_le16(DIAGDIAG_FILE_OPEN_OPERATION);
    memcpy(req_ptr->guid, qshrink4_data.guid[idx], GUID_LEN);

    read_file_total_len = 0;
    read_file_fd = -1;
    parser_state = DB_PARSER_STATE_OPEN;
    diag_send_data(qsr4_db_cmd_req_buf, diag_qsr4_append_crc16(ptr, sizeof(diag_qsr_file_open_req)));
    wait_for_response(&parser_state);

    if (read_file_fd != -1)
    {
        read_file_total_len = cpu_to_le32(qshrink4_data.guid_file_len[idx]);
        disk_file_fd = create_qsr4_db_file(guid_file_name(qshrink4_data.guid[idx]));
    }

    return 0;
}

static void process_qsr_db_file_open_rsp(const uint8_t *buf, size_t size)
{
    (void)size;
    diag_qsr_file_open_rsp *open_rsp = (diag_qsr_file_open_rsp *)buf;

    if (open_rsp->status == 0)
    {
        DBG("open read_file_fd %d", cpu_to_le16(open_rsp->read_file_fd));
        read_file_fd = cpu_to_le16(open_rsp->read_file_fd);
    }
    else
    {
        DBG("%s status %d", __func__, open_rsp->status);
    }

    wakeup_response(&parser_state);
}

static int diag_send_qsr4_file_close_send_req(int idx)
{
    unsigned char *ptr = qsr4_db_cmd_req_buf;
    diag_qsr_file_close_req *req_ptr;

    DBG("%s idx=%d, read_file_fd=%d", __func__, idx, read_file_fd);

    if (read_file_fd == -1)
    {
        return 0;
    }

    if (disk_file_fd != -1)
    {
        close(disk_file_fd);
        disk_file_fd = -1;
    }

    req_ptr = (diag_qsr_file_close_req *)ptr;
    req_ptr->req.cmd_code = DIAG_SUBSYS_CMD_VER_2_F;
    req_ptr->req.subsys_id = DIAG_SUBSYS_DIAG_SERV;
    req_ptr->req.subsys_cmd_code = cpu_to_le16(DIAGDIAG_QSR4_FILE_OP_MODEM);
    req_ptr->req.version = cpu_to_le16(1);
    req_ptr->req.opcode = cpu_to_le16(DIAGDIAG_FILE_CLOSE_OPERATION);
    req_ptr->read_file_fd = cpu_to_le16(read_file_fd);

    parser_state = DB_PARSER_STATE_CLOSE;
    diag_send_data(ptr, diag_qsr4_append_crc16(ptr, sizeof(diag_qsr_file_close_req)));
    wait_for_response(&parser_state);
    read_file_fd = -1;

    return 0;
}

static void process_qsr_db_file_close_rsp(const uint8_t *buf, size_t size)
{
    (void)size;
    diag_qsr_file_close_rsp *close_rsp = (diag_qsr_file_close_rsp *)buf;

    if (cpu_to_le32(close_rsp->status) == 0)
    {
        DBG("close read_file_fd %d", cpu_to_le16(close_rsp->read_file_fd));
        if (read_file_fd == cpu_to_le16(close_rsp->read_file_fd))
        {
            read_file_fd = -1;
        }
    }
    else
    {
        DBG("%s status %d", __func__, cpu_to_le16(close_rsp->status));
    }

    wakeup_response(&parser_state);
}

static int diag_send_qsr4_file_read_cmd_req(unsigned int file_offset, int file_len)
{
    unsigned char *ptr = qsr4_db_cmd_req_buf;
    diag_qsr_file_read_req *req;

    if (read_file_fd == -1)
        return 0;

    if (file_offset >= read_file_total_len)
        return 0;

    if ((file_offset + file_len) > read_file_total_len)
    {
        file_len = read_file_total_len - file_offset;
    }

    if (diag_verbose || (file_offset == 0 || ((file_offset + file_len) == read_file_total_len)))
        DBG("%s offset=%08d, len=%d", __func__, file_offset, file_len);

    req = (diag_qsr_file_read_req *)ptr;
    req->req.cmd_code = DIAG_SUBSYS_CMD_VER_2_F;
    req->req.subsys_id = DIAG_SUBSYS_DIAG_SERV;
    req->req.subsys_cmd_code = cpu_to_le16(diag_qsr4_get_cmd_code_for_peripheral(cur_peripheral));
    req->req.version = cpu_to_le16(1);
    req->req.opcode = cpu_to_le16(DIAGDIAG_FILE_READ_OPERATION);
    req->read_file_fd = cpu_to_le16(read_file_fd);
    req->offset = cpu_to_le32(file_offset);
    req->req_bytes = cpu_to_le32(file_len);

    read_file_len = 0;
    parser_state = DB_PARSER_STATE_READ;
    diag_send_data(ptr, diag_qsr4_append_crc16(ptr, sizeof(diag_qsr_file_read_req)));
    wait_for_response(&parser_state);

    return read_file_len;
}

static void process_qsr_db_file_read_delayed_rsp(const uint8_t *buf, size_t size)
{
    (void)size;
    diag_qsr_file_read_rsp *read_rsp = (diag_qsr_file_read_rsp *)buf;

    if (read_rsp->status == 0)
    {
        uint32 num_read = cpu_to_le32(read_rsp->num_read);
        if (diag_verbose)
            DBG("%s offset=%08x, len=%d, rsp_cnt=%d", __func__, cpu_to_le32(read_rsp->offset), num_read, cpu_to_le16(read_rsp->rsp_cnt));
        if (num_read)
        {
            if (disk_file_fd != -1)
            {
                write(disk_file_fd, read_rsp->data, num_read);
            }
            read_file_len = num_read;
            wakeup_response(&parser_state);
        }
    }
    else
    {
        DBG("%s status %d", __func__, read_rsp->status);
        wakeup_response(&parser_state);
    }
}

static void insert_diag_id_entry(diag_id_entry_struct *entry)
{
    diag_id_list *new_entry;

    if (diag_id_count >= NUM_PROC)
        return;

    new_entry = &(diag_id_table[diag_id_count++]);

    new_entry->diag_id = entry->diag_id;
    strncpy(new_entry->process_name, entry->process_name, 30);
    new_entry->peripheral = diag_query_pd(new_entry->process_name);

    DBG("%s diag_id=%d, peripheral=%d, process_name=%s", __func__,
        new_entry->diag_id, new_entry->peripheral, new_entry->process_name);
}

static int diag_query_diag_id(void)
{
    unsigned char *ptr = qsr4_db_cmd_req_buf;
    diag_id_list_req *req = NULL;

    DBG("%s", __func__);

    req = (diag_id_list_req *)ptr;

    req->cmd_code = DIAG_SUBSYS_CMD_F;
    req->subsys_id = DIAG_SUBSYS_DIAG_SERV;
    req->subsys_cmd_code = cpu_to_le16(DIAG_GET_DIAG_ID);
    req->version = 1;

    diag_id_state = 1;
    diag_send_data(ptr, diag_qsr4_append_crc16(ptr, sizeof(diag_id_list_req)));
    wait_for_response(&diag_id_state);

    return 0;
}

static void process_diag_id_response(const uint8_t *buf, size_t size)
{
    (void)size;
    diag_id_list_rsp *list_rsp = (diag_id_list_rsp *)buf;
    diag_id_entry_struct *diag_id_ptr;
    uint8_t i;

    DBG("%s", __func__);

    if (list_rsp->cmd_code != DIAG_SUBSYS_CMD_F || list_rsp->version != 1)
    {
        DBG("error %d", __LINE__);
        wakeup_response(&diag_id_state);
        return;
    }

    diag_id_ptr = &list_rsp->entry;
    for (i = 0; i < list_rsp->num_entries; i++)
    {
        insert_diag_id_entry(diag_id_ptr);
        diag_id_ptr = (diag_id_entry_struct *)(((uint8_t *)diag_id_ptr) + diag_id_ptr->len + sizeof(diag_id_entry_struct));
    }

    wakeup_response(&diag_id_state);
}

void mdm_handle_data_for_command_rsp(const uint8_t *buf, size_t size)
{
    if (diag_id_state)
    {
        diag_id_list_rsp *rsp = (diag_id_list_rsp *)buf;

        if (diag_verbose)
            DBG("rx=%zd, %02x%02x%02x%02x %02x%02x%02x%02x", size, buf[0], buf[1], buf[2], buf[3], buf[4], buf[5], buf[6], buf[7]);

        if ((buf[0] == DIAG_BAD_CMD_F || buf[0] == DIAG_BAD_PARM_F || buf[0] == DIAG_BAD_LEN_F) && buf[1] == DIAG_SUBSYS_CMD_F && buf[2] == DIAG_SUBSYS_DIAG_SERV)
        {
            DBG("error %d, buf[0]=%d", __LINE__, buf[0]);
            return wakeup_response(&parser_state);
        }

        if (rsp->cmd_code == DIAG_SUBSYS_CMD_F && rsp->subsys_id == DIAG_SUBSYS_DIAG_SERV && cpu_to_le16(rsp->subsys_cmd_code) == DIAG_GET_DIAG_ID)
        {
            return process_diag_id_response(buf, size);
        }
    }
    else if (parser_state)
    {
        diag_qsr_header_rsp *rsp = (diag_qsr_header_rsp *)buf;

        if (diag_verbose)
            DBG("rx=%zd, %02x%02x%02x%02x %02x%02x%02x%02x\n", size, buf[0], buf[1], buf[2], buf[3], buf[4], buf[5], buf[6], buf[7]);

        if ((buf[0] == DIAG_BAD_CMD_F || buf[0] == DIAG_BAD_PARM_F || buf[0] == DIAG_BAD_LEN_F) && buf[1] == DIAG_SUBSYS_CMD_VER_2_F && buf[2] == DIAG_SUBSYS_DIAG_SERV)
        {
            DBG("error %d, buf[0]=%d", __LINE__, buf[0]);
            return wakeup_response(&parser_state);
        }

        if (rsp->cmd_code == DIAG_SUBSYS_CMD_VER_2_F && rsp->subsys_id == DIAG_SUBSYS_DIAG_SERV && cpu_to_le16(rsp->subsys_cmd_code) == DIAGDIAG_QSR4_FILE_OP_MODEM)
        {
            uint16_t opcode = cpu_to_le16(rsp->opcode);

            if (cpu_to_le16(rsp->version) != 1)
            {
                DBG("%s version %d", __func__, cpu_to_le16(rsp->version));
                return wakeup_response(&parser_state);
            }
            else if (opcode == DIAGDIAG_FILE_LIST_OPERATION)
            {
                return process_qsr4_db_file_list_response(buf, size);
            }
            else if (opcode == DIAGDIAG_FILE_OPEN_OPERATION)
            {
                return process_qsr_db_file_open_rsp(buf, size);
            }
            else if (opcode == DIAGDIAG_FILE_CLOSE_OPERATION)
            {
                return process_qsr_db_file_close_rsp(buf, size);
            }
            else if (opcode == DIAGDIAG_FILE_READ_OPERATION)
            {
                return process_qsr_db_file_read_delayed_rsp(buf, size);
            }
            else
            {
                DBG("opcode %04x", opcode);
            }
        }
    }
}

static void mdm_parse_data_for_command_rsp(const uint8_t *src_ptr, size_t src_length)
{
    size_t i, len;
    uint8_t *dest_ptr = mdm_rsp_buf;
    uint8_t src_byte;
    size_t dest_length = (8 * 1024);

_parse_pkt:
    len = mdm_rsp_cur;

    for (i = 0; i < src_length; i++)
    {
        src_byte = src_ptr[i];

        if (src_byte == 0x7d)
        {
            if (i == (src_length - 1))
            {
                i++;
                break;
            }
            else
            {
                dest_ptr[len++] = src_ptr[++i] ^ 0x20;
            }
        }
        else if (src_byte == 0x7e)
        {
            if (i == 0 && src_length > 1)
                continue;
            dest_ptr[len++] = src_byte;
            i++;
            break;
        }
        else
        {
            dest_ptr[len++] = src_byte;
        }

        if (len >= dest_length)
        {
            i++;
            break;
        }
    }

    if (len && dest_ptr[len - 1] == 0x7E)
    {
        if (g_mdm_req && g_mdm_req[0] == dest_ptr[0])
        {
            g_mdm_req = NULL;
        }
        mdm_handle_data_for_command_rsp(dest_ptr, len);
        mdm_rsp_cur = 0;

        if (len > mdm_rsp_size)
        {
            mdm_rsp_size = len;
        }
    }
    else if (len > dest_length)
    {
        mdm_rsp_cur = 0;
        DBG("too long mdm rsp len=%zd", len);
    }
    else
    {
        mdm_rsp_cur = len;
    }

    src_length -= i;
    src_ptr += i;
    if (src_length)
        goto _parse_pkt;
}

static char cmd_disable_log_mask[] = {0x73, 0, 0, 0, 0, 0, 0, 0};
static char cmd_disable_msg_mask[] = {0x7D, 0x05, 0, 0, 0, 0, 0, 0};
static char cmd_disable_event_mask[] = {0x60, 0};
static char cmd_disable_qtrace_mask[] = {0x4B, 0x44, 0x01, 0x90, 0x03, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

void send_empty_mask(void)
{
    unsigned char *ptr = qsr4_db_cmd_req_buf;

    memcpy(ptr, cmd_disable_log_mask, sizeof(cmd_disable_log_mask));
    diag_send_data(ptr, diag_qsr4_append_crc16(ptr, sizeof(cmd_disable_log_mask)));

    memcpy(ptr, cmd_disable_msg_mask, sizeof(cmd_disable_log_mask));
    diag_send_data(ptr, diag_qsr4_append_crc16(ptr, sizeof(cmd_disable_log_mask)));

    memcpy(ptr, cmd_disable_event_mask, sizeof(cmd_disable_event_mask));
    diag_send_data(ptr, diag_qsr4_append_crc16(ptr, sizeof(cmd_disable_event_mask)));

    memcpy(ptr, cmd_disable_qtrace_mask, sizeof(cmd_disable_qtrace_mask));
    diag_send_data(ptr, diag_qsr4_append_crc16(ptr, sizeof(cmd_disable_qtrace_mask)));
}

static void create_qshrink4_file_proc(int fd)
{
    static int qshrink4_init = 0;

    if (qshrink4_init)
        return;
    qshrink4_init = 1;

    if (use_qmdl2_v2 && diag_id_count == 0)
    {
        uint8_t i;

        dm_fd = fd;
        send_empty_mask();
        diag_query_diag_id();
        DBG("diag_id_count %d ", diag_id_count);

        for (i = 0; i < diag_id_count; i++)
        {
            diag_send_qsr4_db_file_list_cmd_req(diag_id_table[i].peripheral);
        }

        for (i = 0; i < cpu_to_le32(qshrink4_data.guid_list_entry_count); i++)
        {
            int read_len;
            unsigned int total_len = 0;

            size_t guid_file_len = get_qsr4_db_filesize(guid_file_name(qshrink4_data.guid[i]));
            if (guid_file_len == cpu_to_le32(qshrink4_data.guid_file_len[i]))
                continue;

            diag_send_qsr4_file_open_cmd_req(i);
            do
            {
                read_len = diag_send_qsr4_file_read_cmd_req(total_len, MAX_QSR4_DB_FILE_READ_PER_RSP);
                total_len += read_len;
            } while (read_len == MAX_QSR4_DB_FILE_READ_PER_RSP);
            DBG("total_len = %u", total_len);
            diag_send_qsr4_file_close_send_req(i);
        }

        mdm_add_qshrink4_header();
    }
}

unsigned char Default_cfg[] = {
  0x1d, 0x1c, 0x3b, 0x7e, 0x00, 0x78, 0xf0, 0x7e, 0x4b, 0x32, 0x06, 0x00,
  0xba, 0x4d, 0x7e, 0x7c, 0x93, 0x49, 0x7e, 0x1c, 0x95, 0x2a, 0x7e, 0x0c,
  0x14, 0x3a, 0x7e, 0x63, 0xe5, 0xa1, 0x7e, 0x4b, 0x0f, 0x00, 0x00, 0xbb,
  0x60, 0x7e, 0x4b, 0x09, 0x00, 0x00, 0x62, 0xb6, 0x7e, 0x4b, 0x08, 0x00,
  0x00, 0xbe, 0xec, 0x7e, 0x4b, 0x08, 0x01, 0x00, 0x66, 0xf5, 0x7e, 0x4b,
  0x04, 0x00, 0x00, 0x1d, 0x49, 0x7e, 0x4b, 0x04, 0x0f, 0x00, 0xd5, 0xca,
  0x7e, 0x4b, 0x0f, 0x18, 0x00, 0x01, 0x9e, 0xa9, 0x7e, 0x4b, 0x0f, 0x18,
  0x00, 0x02, 0x05, 0x9b, 0x7e, 0x4b, 0x0f, 0x2c, 0x00, 0x28, 0xea, 0x7e,
  0x4b, 0x12, 0x39, 0x00, 0xeb, 0x7b, 0x7e, 0x4b, 0x12, 0x3c, 0x00, 0x53,
  0x05, 0x7e, 0x4b, 0x12, 0x37, 0x00, 0xfb, 0xe1, 0x7e, 0x4b, 0x12, 0x3b,
  0x00, 0x5b, 0x48, 0x7e, 0x4b, 0x12, 0x35, 0x00, 0x4b, 0xd2, 0x7e, 0x4b,
  0x12, 0x3a, 0x00, 0x83, 0x51, 0x7e, 0x4b, 0x12, 0x00, 0x08, 0x19, 0x96,
  0x7e, 0x7d, 0x5d, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x74, 0x41,
  0x7e, 0x73, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xda, 0x81, 0x7e,
  0x60, 0x00, 0x12, 0x6a, 0x7e, 0x73, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00,
  0x00, 0x01, 0x00, 0x00, 0x00, 0x2d, 0x0d, 0x00, 0x00, 0xf0, 0x01, 0xc8,
  0x00, 0x00, 0x40, 0xc4, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x49, 0xf3, 0xc7,
  0x5b, 0x7c, 0xf3, 0x0b, 0x01, 0x00, 0x00, 0x00, 0x20, 0xec, 0x00, 0xcc,
  0x83, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00, 0x38, 0x00, 0x38,
  0x00, 0x38, 0x00, 0x00, 0x01, 0x01, 0x00, 0x40, 0x08, 0xf0, 0x07, 0x0c,
  0xf8, 0x47, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x40, 0x04, 0x00, 0xff, 0xf7, 0x7f, 0xf0, 0xfc, 0xff, 0xff, 0xad, 0xe0,
  0x7f, 0x02, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x78, 0xe0, 0xff, 0xff, 0xff, 0x40, 0x1c, 0x1e, 0x00, 0x00,
  0x00, 0xc0, 0xfb, 0xff, 0xff, 0xff, 0xbf, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x80, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
  0x1b, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0xc1, 0x49, 0x41, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x01, 0x00, 0x30, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
  0x00, 0x00, 0x7f, 0xce, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00,
  0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x0c, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
  0x00, 0x00, 0xf8, 0x07, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0xd2, 0x7f,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x40, 0x00, 0x06, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x0a, 0x30, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x06, 0x00, 0x00, 0x40, 0x00,
  0x00, 0x00, 0x00, 0x16, 0x07, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x40, 0x00,
  0x00, 0x08, 0x88, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x0c,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0xc0, 0x07,
  0xc0, 0x3f, 0x40, 0x00, 0xf8, 0xff, 0x0f, 0x48, 0x08, 0x00, 0x04, 0x00,
  0x01, 0x2c, 0x40, 0x00, 0x00, 0x40, 0x08, 0x21, 0x00, 0x00, 0x10, 0x4a,
  0x00, 0x7e, 0x73, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x04, 0x00,
  0x00, 0x00, 0x0b, 0x08, 0x00, 0x00, 0x35, 0x00, 0x09, 0x80, 0xf8, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x7f, 0xef, 0xa2, 0xf8, 0x90, 0x3c, 0x1d, 0x60, 0x04,
  0x00, 0x00, 0x4f, 0x03, 0xfe, 0x07, 0x43, 0x0b, 0x0a, 0x01, 0x00, 0x04,
  0x87, 0xf4, 0xc7, 0x5f, 0xb8, 0x73, 0x00, 0x00, 0x00, 0x00, 0x86, 0x8a,
  0x4d, 0xf8, 0x25, 0x14, 0x00, 0xcc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x82, 0xc3, 0x1e, 0x30, 0x7d, 0x5e,
  0x00, 0x4e, 0x00, 0xff, 0x03, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
  0x07, 0x1c, 0x46, 0x7e, 0x73, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,
  0x05, 0x00, 0x00, 0x00, 0x74, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x9c, 0xff, 0x3b,
  0xfc, 0x03, 0x73, 0xd3, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd0, 0xff, 0xd7,
  0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff,
  0xff, 0xff, 0xbf, 0xfb, 0x4f, 0x7f, 0xbf, 0x00, 0xe0, 0xe3, 0x0f, 0xff,
  0x0d, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x70, 0x90, 0x6f, 0x3f, 0xfc, 0x71, 0x02, 0x00,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0xd0, 0xff, 0x57, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0xf8, 0xe7, 0xff, 0xff,
  0xcf, 0x7f, 0xbf, 0x00, 0xe0, 0xe3, 0x0f, 0xff, 0x0d, 0x00, 0x0f, 0xd8,
  0x8a, 0x7e, 0x73, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x07, 0x00,
  0x00, 0x00, 0x57, 0x0b, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x7f, 0x00, 0x00,
  0x7f, 0x02, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x00,
  0x06, 0x0a, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xff, 0x77, 0x00, 0x00, 0x7f, 0x4a, 0x09, 0x7e,
  0x73, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00,
  0xc1, 0x09, 0x00, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x5f, 0x4c, 0x00, 0x00, 0xce, 0x36, 0xce, 0x00,
  0x3f, 0x01, 0x3f, 0x00, 0xdf, 0xe4, 0x30, 0x00, 0x7f, 0xfc, 0xbc, 0x00,
  0x00, 0x00, 0x3e, 0x28, 0x6e, 0x56, 0x15, 0x12, 0x71, 0xe0, 0x00, 0x08,
  0xff, 0xff, 0xff, 0xe2, 0xef, 0xed, 0x7d, 0x5d, 0x59, 0x7f, 0x08, 0x01,
  0x74, 0x42, 0xe0, 0x00, 0x97, 0x28, 0x84, 0x2c, 0x10, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0x13,
  0x00, 0xfe, 0x1f, 0x00, 0x00, 0xff, 0x78, 0xc0, 0x01, 0x0f, 0x03, 0x0f,
  0x00, 0xff, 0xff, 0xcb, 0x78, 0xdb, 0x7d, 0x5d, 0x00, 0x00, 0xf1, 0xef,
  0x0f, 0x66, 0xa5, 0x00, 0x02, 0x98, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x67, 0x1a, 0xff, 0xff, 0xbf, 0xd2, 0x62, 0xcb,
  0x05, 0x00, 0x8a, 0x01, 0x00, 0x02, 0x01, 0xe6, 0x23, 0x7e, 0x73, 0x00,
  0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x39, 0x01,
  0x00, 0x00, 0x79, 0xa6, 0xff, 0xff, 0xff, 0xa1, 0x1f, 0x00, 0xdf, 0x01,
  0x00, 0x00, 0x03, 0x40, 0x00, 0x00, 0x00, 0x9f, 0x00, 0x00, 0x00, 0x00,
  0xc0, 0x06, 0x00, 0x00, 0x00, 0x00, 0x5f, 0x00, 0x00, 0x00, 0xff, 0x37,
  0xff, 0xbf, 0x1b, 0x05, 0x00, 0x01, 0x2b, 0x17, 0x7e, 0x60, 0x01, 0x9b,
  0x7b, 0x7e, 0x82, 0x00, 0x00, 0x00, 0xce, 0x0c, 0x01, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xbf, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xf0, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x80,
  0xff, 0xff, 0x7f, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff, 0xff, 0x07, 0xff,
  0xfe, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0f, 0xc0, 0xff, 0xff,
  0xff, 0xff, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3f, 0x0c, 0x79,
  0x7e, 0x7d, 0x5d, 0x04, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x4c, 0x06,
  0x7e, 0x7d, 0x5d, 0x04, 0x05, 0x00, 0x05, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0xce, 0xa7, 0x7e, 0x7d, 0x5d, 0x04, 0x07, 0x00, 0x08, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0xd0, 0x71,
  0x7e, 0x7d, 0x5d, 0x04, 0x0b, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x7c, 0x68, 0x7e, 0x7d, 0x5d, 0x04,
  0x0e, 0x00, 0x12, 0x00, 0x00, 0x00, 0xff, 0x01, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0x0e, 0x26, 0x7e, 0x7d, 0x5d, 0x04, 0x14, 0x00, 0x16, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0xed, 0x14, 0x7e, 0x7d, 0x5d, 0x04, 0x19, 0x00, 0x19, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x88, 0xd0, 0x7e, 0x7d, 0x5d, 0x04,
  0x20, 0x00, 0x20, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0xea, 0xaa,
  0x7e, 0x7d, 0x5d, 0x04, 0x27, 0x00, 0x28, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0xfe, 0x01, 0x00, 0x00, 0x89, 0x11, 0x7e, 0x7d, 0x5d, 0x04,
  0x2a, 0x00, 0x2b, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x01, 0x1a, 0x7e, 0x7d, 0x5d, 0x04, 0x32, 0x00, 0x33, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x3a, 0x20,
  0x7e, 0x7d, 0x5d, 0x04, 0x36, 0x00, 0x36, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0xa3, 0xd6, 0x7e, 0x7d, 0x5d, 0x04, 0x39, 0x00, 0x3a, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x65, 0xdf,
  0x7e, 0x7d, 0x5d, 0x04, 0x3f, 0x00, 0x42, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0xfe, 0xff, 0x1f, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0x9f, 0xaf, 0x7e, 0x7d, 0x5d, 0x04, 0x44, 0x00, 0x45, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x2e, 0x6c,
  0x7e, 0x7d, 0x5d, 0x04, 0x48, 0x00, 0x4a, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x4f, 0xf2,
  0x7e, 0x7d, 0x5d, 0x04, 0x4c, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0xf2, 0x66, 0x7e, 0x7d, 0x5d, 0x04, 0x4e, 0x00, 0x4e, 0x00,
  0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x11, 0x0f, 0x7e, 0x7d, 0x5d, 0x04,
  0x53, 0x00, 0x53, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0xf4, 0x5d,
  0x7e, 0x7d, 0x5d, 0x04, 0x58, 0x00, 0x58, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x9a, 0x49, 0x7e, 0x7d, 0x5d, 0x04, 0x5a, 0x00, 0x5b, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x0e, 0x43,
  0x7e, 0x7d, 0x5d, 0x04, 0x5d, 0x00, 0x5d, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0xfb, 0x5e, 0x7e, 0x7d, 0x5d, 0x04, 0x63, 0x00, 0x63, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0xd9, 0x60, 0x7e, 0x7d, 0x5d, 0x04,
  0x70, 0x00, 0x70, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x4a, 0x17,
  0x7e, 0x7d, 0x5d, 0x04, 0xea, 0x03, 0xea, 0x03, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0xa9, 0x9e, 0x7e, 0x7d, 0x5d, 0x04, 0xee, 0x03, 0xef, 0x03,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x9b, 0x20,
  0x7e, 0x7d, 0x5d, 0x04, 0xd0, 0x07, 0xd7, 0x07, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0xdc, 0x10, 0x7e, 0x7d, 0x5d, 0x04,
  0xb8, 0x0b, 0xc5, 0x0b, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0xfe, 0xff,
  0x7f, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1c, 0x00,
  0x00, 0x00, 0xa9, 0x36, 0x7e, 0x7d, 0x5d, 0x04, 0xa0, 0x0f, 0xaa, 0x0f,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0xfe, 0x01, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0xfe, 0xff, 0x01, 0x00, 0xfe, 0xff, 0x07, 0x00, 0xfe, 0xff,
  0x01, 0x00, 0xfe, 0x07, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0xc3, 0xb9,
  0x7e, 0x7d, 0x5d, 0x04, 0x01, 0x12, 0x01, 0x12, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0x90, 0xe7, 0x7e, 0x7d, 0x5d, 0x04, 0x04, 0x12, 0x05, 0x12,
  0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0xbd, 0x05,
  0x7e, 0x7d, 0x5d, 0x04, 0x07, 0x12, 0x07, 0x12, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0xf3, 0x12, 0x7e, 0x7d, 0x5d, 0x04, 0x88, 0x13, 0xa8, 0x13,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x1f, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0xf4, 0x4c, 0x7e, 0x7d, 0x5d, 0x04, 0xaa, 0x13, 0xaa, 0x13,
  0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0xc5, 0xfc, 0x7e, 0x7d, 0x5d, 0x04,
  0x7f, 0x15, 0x7f, 0x15, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x91, 0x4c,
  0x7e, 0x7d, 0x5d, 0x04, 0x72, 0x17, 0x72, 0x17, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0xcc, 0x20, 0x7e, 0x7d, 0x5d, 0x04, 0x74, 0x17, 0x74, 0x17,
  0x00, 0x00, 0x3f, 0x00, 0x00, 0x00, 0x47, 0x46, 0x7e, 0x7d, 0x5d, 0x04,
  0x93, 0x17, 0x93, 0x17, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x8f, 0xca,
  0x7e, 0x7d, 0x5d, 0x04, 0x97, 0x17, 0x97, 0x17, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0xcd, 0x6c, 0x7e, 0x7d, 0x5d, 0x04, 0xa4, 0x17, 0xb7, 0x17,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x8d, 0xd1,
  0x7e, 0x7d, 0x5d, 0x04, 0xc0, 0x17, 0xc0, 0x17, 0x00, 0x00, 0x1e, 0x00,
  0x00, 0x00, 0x96, 0x89, 0x7e, 0x7d, 0x5d, 0x04, 0x34, 0x21, 0x34, 0x21,
  0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x10, 0xc3, 0x7e, 0x7d, 0x5d, 0x04,
  0x1c, 0x25, 0x25, 0x25, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0xff,
  0x1f, 0x00, 0x7d, 0x5e, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x7d,
  0x5e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0xfe, 0x03, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x3e, 0xd0, 0x00, 0x00,
  0x90, 0xed, 0x7e, 0x7d, 0x5d, 0x04, 0x0b, 0x28, 0x0f, 0x28, 0x00, 0x00,
  0x1c, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00,
  0x1c, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x71, 0x86, 0x7e, 0x7d,
  0x5d, 0x04, 0x6e, 0x28, 0x89, 0x28, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
  0x52, 0x90, 0x7e, 0x4b, 0x44, 0x01, 0x90, 0x2b, 0x00, 0x00, 0x00, 0x01,
  0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x06,
  0x00, 0x0f, 0x00, 0x09, 0x00, 0x1e, 0x00, 0x0b, 0x00, 0x03, 0x00, 0x0d,
  0x00, 0x03, 0x00, 0x12, 0x00, 0x01, 0x00, 0x2a, 0x00, 0x03, 0x00, 0x2d,
  0x00, 0x03, 0x00, 0x2f, 0x00, 0x07, 0x00, 0x34, 0x00, 0x0f, 0x00, 0x35,
  0x00, 0x1f, 0x00, 0x36, 0x00, 0x03, 0x00, 0x3d, 0x00, 0x03, 0x00, 0x40,
  0x00, 0x03, 0x00, 0x49, 0x00, 0x0f, 0x00, 0x4c, 0x00, 0x7f, 0x08, 0x4e,
  0x00, 0x02, 0x00, 0x50, 0x00, 0x03, 0x00, 0x53, 0x00, 0x3f, 0x00, 0x54,
  0x00, 0x0f, 0x00, 0x55, 0x00, 0x0f, 0x00, 0x56, 0x00, 0x03, 0x00, 0x57,
  0x00, 0x03, 0x00, 0x58, 0x00, 0x01, 0x00, 0x59, 0x00, 0x0f, 0x00, 0x5e,
  0x00, 0x01, 0x00, 0x60, 0x00, 0x07, 0x00, 0x61, 0x00, 0x03, 0x00, 0x62,
  0x00, 0x0f, 0x00, 0x63, 0x00, 0x03, 0x00, 0x64, 0x00, 0x3f, 0x00, 0x65,
  0x00, 0x03, 0x00, 0x68, 0x00, 0x03, 0x00, 0x69, 0x00, 0x0f, 0x00, 0x6b,
  0x00, 0x03, 0x00, 0x6c, 0x00, 0x03, 0x00, 0x6d, 0x00, 0x03, 0x00, 0x6e,
  0x00, 0x03, 0x00, 0x6f, 0x00, 0x01, 0x00, 0x70, 0x00, 0x01, 0x00, 0x71,
  0x00, 0x03, 0x00, 0xcd, 0xc3, 0x7e
};
unsigned int Default_cfg_len = 3990;
static int mdm_need_parse_data = 0;

static void print_hex(unsigned char *ptr, int len)
{
#if 1
    int i;
    printf("[ ");
    for (i = 0; i < len; i++)
    {
        printf("%02X", ptr[i]);
    }

    printf(" ]\n");
#endif
}
ssize_t qcom_send_cmd(int fd, const unsigned char *buf, size_t size)
{
    size_t wc = 0;

    while (wc < size)
    {
        size_t flag = wc;
        const unsigned char *cur = buf + wc;
        unsigned short len = cur[2] + (((unsigned short)cur[3]) << 8) + 5;

        if (cur[0] == 0x7e && cur[1] == 0x01 && (wc + len) <= size && cur[len - 1] == 0x7e)
        {
            flag += (len - 1);
        }
        else
        {
            if (flag == 0 && buf[flag] == 0x7E)
                flag++;

            while (buf[flag] != 0x7E && flag < size)
                flag++;
        }

        if (buf[flag] == 0x7E || flag == size)
        {
            g_mdm_req = &buf[wc];
            // print_hex(buf + wc,flag - wc + 1);
            safe_poll_write(fd, buf + wc, flag - wc + 1, 1000);

            if (mdm_need_parse_data)
            {
                int rx_wait = 1000;

                while (rx_wait-- > 0)
                {
                    if (g_mdm_req == NULL)
                        break;
                    usleep(1 * 1000);
                }
                if (g_mdm_req != NULL)
                {
                    g_mdm_req = NULL;
                    DBG("timeout g_mdm_req=%02x", buf[wc]);
                }
            }
        }
        else
        {
            DBG("%s unknow mdm cmd", __func__);
        }

        wc = flag + 1;
    }

    return size;
}

int qcom_init_filter(int fd, const char *cfg)
{
    unsigned char *rbuf;
    const size_t rbuf_size = (16 * 1024);
    size_t cfg_size = 0;

    mdm_need_parse_data = 1;
    create_qshrink4_file_proc(fd);

    rbuf = (unsigned char *)malloc(rbuf_size);
    if (rbuf == NULL)
    {
        DBG("Fail to malloc rbuf_size=%zd, errno: %d (%s)", rbuf_size, errno, strerror(errno));
        mdm_need_parse_data = 0;
        return -1;
    }

    if (cfg)
    {
        DBG("cfg %s",cfg);
        int cfgfd = open(cfg, O_RDONLY);
        if (cfgfd < 0)
        {
            DBG("Fail to open %s, errno : %d (%s)", cfg, errno, strerror(errno));
        }
        else
        {
            cfg_size = read(cfgfd, rbuf, rbuf_size);
            close(cfgfd);
        }
    }

    if (cfg_size <= 0)
    {
        cfg_size = sizeof(Default_cfg);
        memcpy(rbuf, Default_cfg, cfg_size);
    }

    qcom_send_cmd(fd, rbuf, cfg_size);

    free(rbuf);

    mdm_need_parse_data = 0;
    return 0;
}

static int mdm_miss_qmdlv2_logfd = -1;
int qcom_logfile_init(int logfd)
{
    if (!use_qmdl2_v2)
        return 0;

    if (cpu_to_le32(qshrink4_data.header_length) == 0)
    {
        mdm_miss_qmdlv2_logfd = logfd;
        return 0;
    }

    mdm_miss_qmdlv2_logfd = -1;
    write(logfd, &qshrink4_data, cpu_to_le32(qshrink4_data.header_length));

    return 0;
}

size_t qcom_logfile_save(int logfd, const void *buf, size_t size)
{
    if (mdm_need_parse_data)
        mdm_parse_data_for_command_rsp(buf, size);

    if (use_qmdl2_v2)
    {
        if (cpu_to_le32(qshrink4_data.header_length) == 0)
            return size;
        else if (mdm_miss_qmdlv2_logfd == logfd)
        {
            mdm_miss_qmdlv2_logfd = -1;
            write(logfd, &qshrink4_data, cpu_to_le32(qshrink4_data.header_length));
        }
    }

    return write(logfd, buf, size);
}